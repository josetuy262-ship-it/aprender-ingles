<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Flashcards Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #4f46e5; --success: #10b981; --error: #ef4444; --text: #1e293b; }
        body { font-family: 'Inter', sans-serif; background: #f1f5f9; color: var(--text); margin: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; }
        
        .header { position: fixed; top: 20px; text-align: center; }
        .progress-text { font-size: 0.9rem; font-weight: 600; color: #64748b; margin-bottom: 8px; }
        .bar-bg { width: 300px; height: 6px; background: #e2e8f0; border-radius: 10px; overflow: hidden; }
        .bar-fill { width: 0%; height: 100%; background: var(--primary); transition: width 0.4s ease; }

        .card-container { perspective: 1000px; width: 340px; height: 480px; margin-top: 80px; }
        .card { position: relative; width: 100%; height: 100%; transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1); transform-style: preserve-3d; }
        .card.is-flipped { transform: rotateY(180deg); }
        
        .face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 24px; background: white; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); display: flex; flex-direction: column; padding: 24px; box-sizing: border-box; }
        .face-back { transform: rotateY(180deg); background: #f8fafc; border: 2px solid var(--primary); }

        .img-box { width: 100%; height: 200px; background: #f1f5f9; border-radius: 16px; overflow: hidden; margin-bottom: 20px; }
        img { width: 100%; height: 100%; object-fit: cover; transition: opacity 0.3s; }
        
        .word-en { font-size: 32px; font-weight: 800; color: var(--primary); margin: 0; }
        .sentence-en { font-size: 18px; color: #475569; margin-top: 12px; line-height: 1.5; flex-grow: 1; }
        
        .word-es { font-size: 28px; font-weight: 700; color: var(--success); }
        .sentence-es { font-size: 16px; color: #64748b; margin-top: 10px; font-style: italic; }

        .controls { display: flex; gap: 12px; margin-top: 30px; width: 340px; }
        button { flex: 1; padding: 16px; border: none; border-radius: 16px; font-weight: 700; cursor: pointer; transition: all 0.2s; font-size: 14px; }
        .btn-hard { background: #fee2e2; color: var(--error); }
        .btn-easy { background: #dcfce7; color: var(--success); }
        button:active { transform: scale(0.95); }
        
        .btn-audio { background: white; color: var(--primary); border: 2px solid #e2e8f0; margin-top: 10px; width: 340px; }
    </style>
</head>
<body>

    <div class="header">
        <div class="progress-text" id="progress-txt">Aprendido: 0%</div>
        <div class="bar-bg"><div class="bar-fill" id="bar"></div></div>
    </div>

    <div class="card-container" onclick="toggleFlip()">
        <div class="card" id="card">
            <div class="face">
                <div class="img-box"><img id="c-img" src="" alt=""></div>
                <div class="word-en" id="c-word">Cargando...</div>
                <div class="sentence-en" id="c-sent">...</div>
            </div>
            <div class="face face-back">
                <div style="color: #64748b; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">TraducciÃ³n</div>
                <div class="word-es" id="c-trans">...</div>
                <div class="sentence-es" id="c-sent-es">...</div>
            </div>
        </div>
    </div>

    <div class="controls">
        <button class="btn-hard" onclick="answer(false)">REPETIR</button>
        <button class="btn-easy" onclick="answer(true)">LO SÃ‰</button>
    </div>
    <button class="btn-audio" onclick="speak()">ðŸ”Š ESCUCHAR</button>

    <script>
        const rawDeck = [
            { w: "Life", t: "Vida", s: "Life is a beautiful journey.", st: "La vida es un viaje hermoso.", i: "https://images.unsplash.com/photo-1500622764614-be3c178304c1?w=400" },
            { w: "World", t: "Mundo", s: "Travel around the world.", st: "Viajar por todo el mundo.", i: "https://images.unsplash.com/photo-1451187580459-43490279c0fa?w=400" },
            { w: "Work", t: "Trabajo", s: "I have a lot of work today.", st: "Tengo mucho trabajo hoy.", i: "https://images.unsplash.com/photo-1497032628192-86f99bcd76bc?w=400" },
            { w: "House", t: "Casa", s: "This is my new house.", st: "Esta es mi nueva casa.", i: "https://images.unsplash.com/photo-1518780664697-55e3ad937233?w=400" },
            { w: "Think", t: "Pensar", s: "I think you are right.", st: "Pienso que tienes razÃ³n.", i: "https://images.unsplash.com/photo-1494173853739-c21f58b16055?w=400" },
            { w: "Change", t: "Cambio", s: "Change is always good.", st: "El cambio siempre es bueno.", i: "https://images.unsplash.com/photo-1501139083538-0139583c060f?w=400" },
            { w: "Light", t: "Luz", s: "The light is very bright.", st: "La luz es muy brillante.", i: "https://images.unsplash.com/photo-1467810563316-b5476525c0f9?w=400" }
        ];

        let deck = JSON.parse(localStorage.getItem('refold_v2')) || rawDeck.map(item => ({...item, level: 0}));
        let index = 0;
        const synth = window.speechSynthesis;

        function update() {
            const item = deck[index];
            const card = document.getElementById('card');
            
            // 1. Resetear visuales para evitar lag de imagen anterior
            card.classList.remove('is-flipped');
            document.getElementById('c-img').style.opacity = 0;
            
            setTimeout(() => {
                document.getElementById('c-word').innerText = item.w;
                document.getElementById('c-sent').innerText = item.s;
                document.getElementById('c-trans').innerText = item.t;
                document.getElementById('c-sent-es').innerText = item.st;
                document.getElementById('c-img').src = item.i;
                document.getElementById('c-img').onload = () => document.getElementById('c-img').style.opacity = 1;
                
                // Progreso
                const done = deck.filter(c => c.level > 0).length;
                const perc = Math.round((done / deck.length) * 100);
                document.getElementById('bar').style.width = perc + "%";
                document.getElementById('progress-txt').innerText = `Aprendido: ${perc}%`;
                
                speak();
            }, 300); // PequeÃ±a espera para que la tarjeta termine de voltearse al frente
        }

        function toggleFlip() { document.getElementById('card').classList.toggle('is-flipped'); }

        function answer(easy) {
            event.stopPropagation();
            if(easy) {
                deck[index].level++;
                const item = deck.splice(index, 1)[0];
                deck.push(item);
            } else {
                deck[index].level = 0;
                const item = deck.splice(index, 1)[0];
                deck.splice(2, 0, item); // Aparece muy pronto
            }
            localStorage.setItem('refold_v2', JSON.stringify(deck));
            update();
        }

        function speak() {
            synth.cancel();
            const item = deck[index];
            const w = new SpeechSynthesisUtterance(item.w);
            const s = new SpeechSynthesisUtterance(item.s);
            w.lang = s.lang = 'en-US';
            w.rate = 0.8;
            s.rate = 0.8;
            
            synth.speak(w);
            w.onend = () => setTimeout(() => synth.speak(s), 300);
        }

        // Inicializar voces (Fix para algunos navegadores)
        window.onload = () => {
            update();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = () => {}; 
            }
        };
    </script>
</body>
</html>
