<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refold Mastery Offline</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root { --bg: #05070a; --card: #111827; --accent: #6366f1; --success: #10b981; --text: #f8fafc; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; height: 100vh; overflow: hidden; }

        /* NavegaciÃ³n */
        nav { width: 260px; background: #0f172a; border-right: 1px solid rgba(255,255,255,0.05); padding: 20px; display: flex; flex-direction: column; }
        .nav-item { padding: 12px; border-radius: 12px; cursor: pointer; margin-bottom: 5px; color: #94a3b8; display: flex; align-items: center; gap: 10px; font-weight: 600; transition: 0.2s; }
        .nav-item:hover, .nav-item.active { background: rgba(99, 102, 241, 0.1); color: white; }
        .nav-item.locked { opacity: 0.4; cursor: not-allowed; }

        /* Contenido Principal */
        main { flex: 1; position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center; background: radial-gradient(circle at top, #111827, #05070a); }
        
        /* Dashboard */
        #dashboard-view { display: none; width: 90%; max-width: 500px; animation: fadeIn 0.4s; }
        .stat-box { background: var(--card); padding: 20px; border-radius: 24px; border: 1px solid rgba(255,255,255,0.05); margin-bottom: 20px; }

        /* Card System */
        .card-container { perspective: 1200px; width: 330px; height: 460px; }
        .card { width: 100%; height: 100%; position: relative; transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); transform-style: preserve-3d; cursor: pointer; }
        .card.is-flipped { transform: rotateY(180deg); }
        .face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 35px; padding: 25px; box-sizing: border-box; display: flex; flex-direction: column; align-items: center; background: var(--card); border: 1px solid rgba(255,255,255,0.1); }
        .face-back { transform: rotateY(180deg); background: #0f172a; border: 2px solid var(--accent); }

        .img-box { width: 100%; height: 200px; border-radius: 20px; overflow: hidden; margin-bottom: 20px; background: #000; }
        img { width: 100%; height: 100%; object-fit: cover; }

        .word { font-size: 32px; font-weight: 800; text-align: center; }
        .sentence { font-size: 16px; color: #94a3b8; margin-top: 10px; text-align: center; font-style: italic; }

        .controls { display: flex; gap: 12px; width: 330px; margin-top: 25px; }
        .btn { flex: 1; padding: 18px; border: none; border-radius: 20px; font-weight: 800; cursor: pointer; transition: 0.2s; }
        .btn-skip { background: #1e293b; color: #94a3b8; }
        .btn-next { background: var(--accent); color: white; }

        /* Overlay */
        #start-screen { position: fixed; inset: 0; background: var(--bg); z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .start-btn { background: var(--accent); padding: 20px 60px; border-radius: 50px; font-size: 1.5rem; font-weight: 800; color: white; border: none; cursor: pointer; box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body onclick="handleFirstTouch()">

    <div id="start-screen">
        <h1 style="font-size: 2.5rem; margin-bottom: 10px;">Refold Journey</h1>
        <p style="color: #64748b; margin-bottom: 40px;">Modo Offline Activado âœ…</p>
        <button class="start-btn" onclick="startApp()">COMENZAR</button>
    </div>

    <nav>
        <div style="font-weight: 800; color: var(--accent); margin-bottom: 30px; font-size: 1.2rem;">MENU</div>
        <div class="nav-item active" onclick="changeView('study')">ðŸ“– Estudiar</div>
        <div class="nav-item" onclick="changeView('stats')">ðŸ“Š Progreso</div>
        <div style="margin: 20px 0; height: 1px; background: rgba(255,255,255,0.05);"></div>
        <div id="deck-list"></div>
    </nav>

    <main>
        <div id="study-view" style="display: flex; flex-direction: column; align-items: center;">
            <div id="streak-label" style="color: #fbbf24; font-weight: 800; margin-bottom: 15px;">ðŸ”¥ Racha: 0 dÃ­as</div>
            <div class="card-container">
                <div class="card" id="card" onclick="this.classList.toggle('is-flipped')">
                    <div class="face">
                        <div class="img-box"><img id="q-img" src="" alt=""></div>
                        <div class="word" id="q-word">...</div>
                        <div class="sentence" id="q-sent">...</div>
                    </div>
                    <div class="face face-back">
                        <div style="font-size: 0.7rem; letter-spacing: 2px; color: var(--accent); margin-bottom: 10px;">TRADUCCIÃ“N</div>
                        <div class="word" id="a-word" style="color: var(--success);">...</div>
                        <div class="sentence" id="a-sent" style="color: white;">...</div>
                    </div>
                </div>
            </div>
            <div class="controls">
                <button class="btn btn-skip" onclick="answer(false)">REPETIR</button>
                <button class="btn btn-next" onclick="answer(true)">Â¡LO TENGO!</button>
            </div>
        </div>

        <div id="dashboard-view">
            <div class="stat-box">
                <h4 style="margin: 0 0 15px 0;">Tu Actividad Semanal</h4>
                <canvas id="myChart"></canvas>
            </div>
            <div class="stat-box" style="text-align: center;">
                <h2 id="total-learned" style="margin: 0; color: var(--success);">0</h2>
                <p style="margin: 5px 0 0 0; color: #94a3b8;">Palabras aprendidas</p>
            </div>
        </div>
    </main>

    <script>
        // DATOS INTEGRADOS (MAZO 1)
        const allDecks = {
            1: [
                { w: "Actually", t: "En realidad", s: "Actually, it's easy.", st: "En realidad, es fÃ¡cil.", k: "truth" },
                { w: "Development", t: "Desarrollo", s: "Focus on development.", st: "EnfÃ³cate en el desarrollo.", k: "code" },
                { w: "Available", t: "Disponible", s: "Is it available?", st: "Â¿EstÃ¡ disponible?", k: "open" },
                { w: "Challenge", t: "DesafÃ­o", s: "Accept the challenge.", st: "Acepta el desafÃ­o.", k: "mountain" },
                { w: "Improvement", t: "Mejora", s: "I see improvement.", st: "Veo una mejora.", k: "success" }
            ],
            // Los otros mazos se llenarÃ¡n igual...
        };

        let db = JSON.parse(localStorage.getItem('refold_offline_final')) || {
            currentDeck: 1, index: 0, streak: 0, lastDate: "", history: [0, 0, 0, 0, 0, 0, 0]
        };

        let chart;
        const synth = window.speechSynthesis;

        function startApp() {
            document.getElementById('start-screen').style.display = 'none';
            updateStreak();
            updateMenu();
            render();
            initChart();
        }

        function updateStreak() {
            const today = new Date().toDateString();
            if(db.lastDate !== today) {
                db.streak++;
                db.lastDate = today;
                save();
            }
            document.getElementById('streak-label').innerText = `ðŸ”¥ Racha: ${db.streak} dÃ­as`;
        }

        function updateMenu() {
            const container = document.getElementById('deck-list');
            container.innerHTML = '';
            for(let i=1; i<=10; i++) {
                const isLocked = i > 1; // AquÃ­ puedes poner la lÃ³gica del Lunes
                const item = document.createElement('div');
                item.className = `nav-item ${isLocked ? 'locked' : ''} ${db.currentDeck === i ? 'active' : ''}`;
                item.innerHTML = `ðŸ“¦ Mazo ${i} ${isLocked ? 'ðŸ”’' : ''}`;
                if(!isLocked) item.onclick = () => { db.currentDeck = i; render(); changeView('study'); };
                container.appendChild(item);
            }
        }

        function render() {
            const item = allDecks[db.currentDeck][db.index % allDecks[db.currentDeck].length];
            document.getElementById('q-word').innerText = item.w;
            document.getElementById('q-sent').innerText = item.s;
            document.getElementById('a-word').innerText = item.t;
            document.getElementById('a-sent').innerText = item.st;
            document.getElementById('q-img').src = `https://source.unsplash.com/featured/?${item.k}`;
            document.getElementById('card').classList.remove('is-flipped');
            speak(item.w, item.s);
        }

        function answer(correct) {
            if(correct) {
                db.index++;
                const dayIdx = (new Date().getDay() + 6) % 7;
                db.history[dayIdx]++;
            }
            save();
            render();
            if(chart) updateChart();
        }

        function changeView(view) {
            document.getElementById('study-view').style.display = view === 'study' ? 'flex' : 'none';
            document.getElementById('dashboard-view').style.display = view === 'stats' ? 'block' : 'none';
        }

        function speak(w, s) {
            synth.cancel();
            const u = new SpeechSynthesisUtterance(`${w}. ${s}`);
            u.lang = 'en-US'; u.rate = 0.8;
            synth.speak(u);
        }

        function save() { localStorage.setItem('refold_offline_final', JSON.stringify(db)); }

        function initChart() {
            const ctx = document.getElementById('myChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['L', 'M', 'X', 'J', 'V', 'S', 'D'],
                    datasets: [{ label: 'Tarjetas', data: db.history, backgroundColor: '#6366f1' }]
                },
                options: { scales: { y: { beginAtZero: true } } }
            });
            updateChart();
        }

        function updateChart() {
            chart.data.datasets[0].data = db.history;
            chart.update();
            document.getElementById('total-learned').innerText = db.history.reduce((a,b)=>a+b, 0);
        }

        function handleFirstTouch() {
            // Desbloquea audio en mÃ³viles/Windows
            if(synth.speaking) return;
            const u = new SpeechSynthesisUtterance("");
            synth.speak(u);
        }
    </script>
</body>
</html>
