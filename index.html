<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refold Journey Ultimate</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bg: #05070a; --card: #111827; --accent: #6366f1; --success: #10b981; --text: #f8fafc; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* Menu Lateral SIEMPRE VISIBLE */
        nav { width: 280px; background: #0f172a; border-right: 2px solid #1e293b; padding: 20px; display: flex; flex-direction: column; height: 100vh; box-sizing: border-box; }
        .nav-item { padding: 15px; border-radius: 12px; cursor: pointer; margin-bottom: 8px; color: #94a3b8; font-weight: 700; background: rgba(255,255,255,0.02); transition: 0.3s; border: 1px solid transparent; }
        .nav-item.active { background: var(--accent); color: white; border-color: #818cf8; }
        .nav-item.special { background: #fbbf24; color: #000; }

        /* Contenido */
        main { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; }
        .view { display: none; flex-direction: column; align-items: center; width: 100%; }
        .view.active { display: flex; }

        /* Tarjeta */
        .card-container { perspective: 1200px; width: 340px; height: 480px; margin: 20px 0; }
        .card { width: 100%; height: 100%; position: relative; transition: transform 0.6s; transform-style: preserve-3d; cursor: pointer; }
        .card.is-flipped { transform: rotateY(180deg); }
        .face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 40px; padding: 30px; box-sizing: border-box; display: flex; flex-direction: column; align-items: center; background: var(--card); border: 1px solid rgba(255,255,255,0.1); }
        .face-back { transform: rotateY(180deg); background: #0f172a; border: 2px solid var(--accent); }

        .img-box { width: 100%; height: 220px; border-radius: 25px; overflow: hidden; margin-bottom: 25px; background: #000; }
        img { width: 100%; height: 100%; object-fit: cover; }

        .word { font-size: 32px; font-weight: 800; }
        .sentence { font-size: 18px; color: #94a3b8; margin-top: 15px; text-align: center; font-style: italic; }

        /* Botones */
        .controls { display: flex; gap: 15px; width: 340px; }
        .btn { flex: 1; padding: 20px; border: none; border-radius: 25px; font-weight: 800; cursor: pointer; font-size: 1rem; color: white; }
        .btn-repeat { background: #334155; }
        .btn-next { background: var(--accent); }

        /* Pantalla Inicio */
        #overlay { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <div id="overlay">
        <h1 style="font-size: 3rem; margin-bottom: 20px;">Refold Journey</h1>
        <button onclick="iniciar()" style="padding: 20px 60px; border-radius: 50px; background: var(--accent); color: white; border: none; font-size: 1.5rem; font-weight: 800; cursor: pointer;">COMENZAR REPASO</button>
    </div>

    <nav>
        <div style="font-size: 1.5rem; font-weight: 800; margin-bottom: 30px; color: var(--accent);">REFOLD PRO</div>
        <div id="menu-items">
            </div>
        <div style="margin-top: auto;">
            <div class="nav-item" onclick="cambiarVista('stats')">üìä Mi Progreso</div>
        </div>
    </nav>

    <main>
        <div id="study-view" class="view active">
            <div id="streak-info" style="color: #fbbf24; font-weight: 800; margin-bottom: 10px;">üî• Racha: 0 d√≠as</div>
            <div class="card-container">
                <div class="card" id="card" onclick="this.classList.toggle('is-flipped')">
                    <div class="face">
                        <div class="img-box"><img id="q-img" src=""></div>
                        <div class="word" id="q-word">Cargando...</div>
                        <div class="sentence" id="q-sent">...</div>
                    </div>
                    <div class="face face-back">
                        <div style="color: var(--accent); font-weight: 800; margin-bottom: 20px;">TRADUCCI√ìN</div>
                        <div class="word" id="a-word" style="color: var(--success);">...</div>
                        <div class="sentence" id="a-sent" style="color: white;">...</div>
                    </div>
                </div>
            </div>
            <div class="controls">
                <button class="btn btn-repeat" onclick="responder(false)">REPETIR</button>
                <button class="btn btn-next" onclick="responder(true)">¬°LO TENGO!</button>
            </div>
        </div>

        <div id="stats-view" class="view">
            <div style="background: var(--card); padding: 30px; border-radius: 30px; width: 90%; max-width: 500px;">
                <canvas id="grafica"></canvas>
                <h2 id="total-hoy" style="text-align: center; margin-top: 20px; font-size: 3rem;">0</h2>
                <p style="text-align: center; color: #94a3b8;">Tarjetas hoy</p>
                <button onclick="cambiarVista('study')" style="width: 100%; padding: 15px; border-radius: 15px; border: none; background: var(--accent); color: white; font-weight: 800; margin-top: 20px; cursor: pointer;">VOLVER A ESTUDIAR</button>
            </div>
        </div>
    </main>

    <script>
        // DATOS (Aqu√≠ meteremos las 1000 divididas por bloques)
        const mazos = {
            "repaso_sabado": [
                { w: "Actually", t: "En realidad", s: "Actually, it's very easy.", st: "En realidad, es muy f√°cil.", i: "https://picsum.photos/seed/1/400/300" },
                { w: "Development", t: "Desarrollo", s: "Focus on development.", st: "Enf√≥cate en el desarrollo.", i: "https://picsum.photos/seed/2/400/300" },
                { w: "Knowledge", t: "Conocimiento", s: "Knowledge is power.", st: "El conocimiento es poder.", i: "https://picsum.photos/seed/3/400/300" }
            ],
            "mazo_1": [{ w: "Example", t: "Ejemplo", s: "This is an example.", st: "Este es un ejemplo.", i: "https://picsum.photos/seed/4/400/300" }]
        };

        let datos = JSON.parse(localStorage.getItem('refold_vFinal')) || {
            mazoActual: "repaso_sabado",
            indice: 0,
            racha: 0,
            ultimaVez: "",
            historial: [0, 0, 0, 0, 0, 0, 0]
        };

        const locutor = window.speechSynthesis;
        let chart;

        function iniciar() {
            document.getElementById('overlay').style.display = 'none';
            // Desbloquear sonido en Windows
            locutor.cancel();
            const dummy = new SpeechSynthesisUtterance("Start");
            dummy.volume = 0;
            locutor.speak(dummy);

            actualizarRacha();
            dibujarMenu();
            mostrarTarjeta();
            initGrafica();
        }

        function dibujarMenu() {
            const menu = document.getElementById('menu-items');
            menu.innerHTML = "";
            
            // Bot√≥n S√°bado (Solo si es s√°bado)
            if(new Date().getDay() === 6) {
                const b = crearBoton("‚≠ê REPASO S√ÅBADO", "repaso_sabado");
                b.classList.add('special');
                menu.appendChild(b);
            }

            // Mazos del 1 al 10
            for(let i=1; i<=10; i++) {
                const id = "mazo_" + i;
                menu.appendChild(crearBoton("üì¶ Mazo " + i, id));
            }
        }

        function crearBoton(texto, id) {
            const div = document.createElement('div');
            div.className = "nav-item " + (datos.mazoActual === id ? "active" : "");
            div.innerText = texto;
            div.onclick = () => { 
                datos.mazoActual = id; 
                datos.indice = 0; 
                dibujarMenu();
                cambiarVista('study');
                mostrarTarjeta();
            };
            return div;
        }

        function mostrarTarjeta() {
            const mazo = mazos[datos.mazoActual] || mazos["repaso_sabado"];
            const card = mazo[datos.indice % mazo.length];

            document.getElementById('q-word').innerText = card.w;
            document.getElementById('q-sent').innerText = card.s;
            document.getElementById('a-word').innerText = card.t;
            document.getElementById('a-sent').innerText = card.st;
            document.getElementById('q-img').src = card.i;
            document.getElementById('card').classList.remove('is-flipped');
            
            // AUDIO FORZADO
            hablar(`${card.w}. ${card.s}`);
        }

        function hablar(texto) {
            locutor.cancel();
            const frase = new SpeechSynthesisUtterance(texto);
            frase.lang = 'en-US';
            frase.rate = 0.8;
            locutor.speak(frase);
        }

        function responder(correcto) {
            if(correcto) {
                datos.indice++;
                const dia = (new Date().getDay() + 6) % 7;
                datos.historial[dia]++;
                guardar();
            }
            mostrarTarjeta();
            if(chart) actualizarGrafica();
        }

        function cambiarVista(v) {
            document.getElementById('study-view').classList.toggle('active', v === 'study');
            document.getElementById('stats-view').classList.toggle('active', v === 'stats');
        }

        function actualizarRacha() {
            const hoy = new Date().toDateString();
            if(datos.ultimaVez !== hoy) {
                datos.racha++;
                datos.ultimaVez = hoy;
                guardar();
            }
            document.getElementById('streak-info').innerText = `üî• Racha: ${datos.racha} d√≠as`;
        }

        function guardar() { localStorage.setItem('refold_vFinal', JSON.stringify(datos)); }

        function initGrafica() {
            const ctx = document.getElementById('grafica').getContext('2d');
            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['L', 'M', 'M', 'J', 'V', 'S', 'D'],
                    datasets: [{ label: 'Completadas', data: datos.historial, backgroundColor: '#6366f1' }]
                },
                options: { responsive: true, scales: { y: { beginAtZero: true } } }
            });
            actualizarGrafica();
        }

        function actualizarGrafica() {
            chart.update();
            const hoyIdx = (new Date().getDay() + 6) % 7;
            document.getElementById('total-hoy').innerText = datos.historial[hoyIdx];
        }
    </script>
</body>
</html>
